<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BuscaCEP Inteligente</title>
<style>
:root {
  --primary: #2c3e50;
  --secondary: #3498db;
  --error: #e74c3c;
  --success: #27ae60;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', sans-serif;
}

body {
  min-height: 100vh;
  display: grid;
  place-items: center;
  background: #f8f9fa;
  padding: 1rem;
}

.container {
  width: 100%;
  max-width: 600px;
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

h1 {
  text-align: center;
  margin-bottom: 1rem;
  color: var(--primary);
}

.toggle-buttons {
  display: flex;
  justify-content: center;
  margin-bottom: 1rem;
}

.toggle-buttons button {
  flex: 1;
  padding: 0.5rem;
  border: 2px solid var(--secondary);
  background: white;
  color: var(--primary);
  font-weight: 600;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.3s ease;
}

.toggle-buttons button.active {
  background: var(--secondary);
  color: white;
}

.search-form {
  display: grid;
  gap: 1rem;
  margin-bottom: 1rem;
}

.input-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

label {
  font-weight: 600;
  color: var(--primary);
}

input {
  padding: 0.8rem;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

input:focus {
  outline: none;
  border-color: var(--secondary);
}

button[type="submit"] {
  background: var(--secondary);
  color: white;
  border: none;
  padding: 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  text-transform: uppercase;
  transition: background 0.3s ease;
}

button[type="submit"]:hover {
  background: #2980b9;
}

.loading, .error, .success {
  text-align: center;
  padding: 0.8rem;
  margin-top: 1rem;
  border-radius: 6px;
  display: none;
}

.loading { color: var(--primary); }
.error { color: var(--error); background: #fdecea; }
.success { color: var(--success); background: #eafaf1; }

.results {
  margin-top: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
  overflow: hidden;
}

.result-item {
  padding: 1rem;
  border-bottom: 1px solid #eee;
  transition: background 0.3s ease;
}

.result-item:hover {
  background: #fff;
}

.cep {
  color: var(--secondary);
  font-weight: bold;
  font-size: 1.2rem;
}

@media (max-width: 480px) {
  .container { padding: 1rem; }
}
</style>
</head>
<body>
<div class="container">

  <form class="search-form" id="searchForm">
    <div id="formLogradouro">
      <div class="input-group">
        <label for="logradouro">Logradouro (Rua/Avenida):</label>
        <input type="text" id="logradouro" placeholder="Ex: Avenida Paulista">
      </div>
      <div class="input-group">
        <label for="cidade">Cidade:</label>
        <input type="text" id="cidade" placeholder="Ex: São Paulo">
      </div>
      <div class="input-group">
        <label for="uf">UF (Estado):</label>
        <input type="text" id="uf" placeholder="Ex: SP" maxlength="2">
      </div>
    </div>

    <div id="formCep" style="display: none;">
      <div class="input-group">
        <label for="cep">CEP:</label>
        <input type="text" id="cep" placeholder="Ex: 01001-000">
      </div>
    </div>

    <button type="submit">Buscar</button>
  </form>

  <div class="loading" id="loading">⌛ Buscando informações...</div>
  <div class="error" id="error"></div>
  <div class="success" id="success"></div>
  <div class="results" id="results"></div>
</div>

<script>
const form = document.getElementById('searchForm');
const modeLogradouro = document.getElementById('modeLogradouro');
const modeCep = document.getElementById('modeCep');
const formLogradouro = document.getElementById('formLogradouro');
const formCep = document.getElementById('formCep');
const loading = document.getElementById('loading');
const errorDiv = document.getElementById('error');
const successDiv = document.getElementById('success');
const results = document.getElementById('results');

let currentMode = 'logradouro';

const toggleMode = (mode) => {
  currentMode = mode;
  if (mode === 'logradouro') {
    formLogradouro.style.display = 'block';
    formCep.style.display = 'none';
    modeLogradouro.classList.add('active');
    modeCep.classList.remove('active');
  } else {
    formLogradouro.style.display = 'none';
    formCep.style.display = 'block';
    modeCep.classList.add('active');
    modeLogradouro.classList.remove('active');
  }
  errorDiv.style.display = 'none';
  successDiv.style.display = 'none';
  results.style.display = 'none';
};

modeLogradouro.addEventListener('click', () => toggleMode('logradouro'));
modeCep.addEventListener('click', () => toggleMode('cep'));

const showError = (message) => {
  errorDiv.textContent = message;
  errorDiv.style.display = 'block';
  loading.style.display = 'none';
  successDiv.style.display = 'none';
};

const showSuccess = (message) => {
  successDiv.textContent = message;
  successDiv.style.display = 'block';
  loading.style.display = 'none';
  errorDiv.style.display = 'none';
};

const formatAddress = (data) => `
  <div class="result-item">
    <div class="cep">CEP: ${data.cep}</div>
    <div>${data.logradouro || ''}</div>
    <div>${data.bairro || ''}</div>
    <div>${data.localidade} - ${data.uf}</div>
    <small>${data.complemento ? 'Complemento: ' + data.complemento : ''}</small>
  </div>
`;

const searchByLogradouro = async (logradouro, cidade, uf) => {
  try {
    loading.style.display = 'block';
    const response = await fetch(`https://viacep.com.br/ws/${uf}/${cidade}/${logradouro}/json/`);
    if (!response.ok) throw new Error('Erro na requisição');
    const data = await response.json();
    if (!data.length) {
      showError('Nenhum resultado encontrado.');
      return;
    }
    results.innerHTML = data.map(formatAddress).join('');
    results.style.display = 'block';
    showSuccess('Busca concluída com sucesso!');
  } catch (err) {
    showError(err.message || 'Erro ao buscar CEP');
  } finally {
    loading.style.display = 'none';
  }
};

const searchByCep = async (cep) => {
  try {
    loading.style.display = 'block';
    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
    if (!response.ok) throw new Error('Erro na requisição');
    const data = await response.json();
    if (data.erro) {
      showError('CEP não encontrado.');
      return;
    }
    results.innerHTML = formatAddress(data);
    results.style.display = 'block';
    showSuccess('Endereço encontrado!');
  } catch (err) {
    showError(err.message || 'Erro ao buscar CEP');
  } finally {
    loading.style.display = 'none';
  }
};

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  errorDiv.style.display = 'none';
  successDiv.style.display = 'none';
  results.style.display = 'none';

  if (currentMode === 'logradouro') {
    const logradouro = document.getElementById('logradouro').value.trim();
    const cidade = document.getElementById('cidade').value.trim();
    const uf = document.getElementById('uf').value.trim().toUpperCase();
    if (!logradouro || !cidade || uf.length !== 2) {
      showError('Preencha todos os campos corretamente (UF deve ter 2 letras).');
      return;
    }
    await searchByLogradouro(logradouro, cidade, uf);
  } else {
    const cep = document.getElementById('cep').value.replace(/\D/g, '');
    if (cep.length !== 8) {
      showError('CEP deve ter 8 dígitos numéricos.');
      return;
    }
    await searchByCep(cep);
  }
});

// Validação em tempo real do campo UF
document.getElementById('uf').addEventListener('input', function() {
  this.value = this.value.replace(/[^a-zA-Z]/g, '').toUpperCase();
});
</script>
</body>
</html>
